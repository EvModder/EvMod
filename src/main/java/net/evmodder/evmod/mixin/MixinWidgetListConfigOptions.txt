package net.evmodder.evmod.mixin;

import com.mojang.datafixers.util.Pair;
import fi.dy.masa.malilib.gui.GuiConfigsBase;
import fi.dy.masa.malilib.gui.widgets.WidgetConfigOption;
import fi.dy.masa.malilib.gui.widgets.WidgetListConfigOptions;
import fi.dy.masa.malilib.gui.widgets.WidgetListConfigOptionsBase;
import net.evmodder.evmod.config.ConfigGui;
import org.spongepowered.asm.mixin.Final;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.Shadow;
import org.spongepowered.asm.mixin.injection.At;
import org.spongepowered.asm.mixin.injection.Inject;
import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;

@Mixin(value=WidgetListConfigOptions.class, remap=false)
abstract class WidgetListConfigOptionsMixin extends WidgetListConfigOptionsBase<GuiConfigsBase.ConfigOptionWrapper, WidgetConfigOption>{
	@Shadow @Final protected final GuiConfigsBase parent;

	public WidgetListConfigOptionsMixin(int x, int y, int width, int height, int configWidth){
		super(x, y, width, height, configWidth);
		throw new RuntimeException();
	}

	@Inject(method="reCreateListEntryWidgets", at=@At(value="INVOKE",
			target="Lfi/dy/masa/malilib/gui/widgets/WidgetListConfigOptionsBase;reCreateListEntryWidgets()V"))
	private final void adjustConfigAndOptionPanelWidth(CallbackInfo ci){
		if(parent instanceof ConfigGui cg){
			Pair<Integer, Integer> result = cg.adjustWidths(totalWidth, maxLabelWidth);
			maxLabelWidth = result.getFirst();
			configWidth = result.getSecond();
		}
	}
}